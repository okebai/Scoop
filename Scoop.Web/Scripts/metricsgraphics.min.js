(function(){"use strict";(function(n,t){typeof define=="function"&&define.amd?define(["d3","jquery"],t):typeof exports=="object"?module.exports=t(require("d3"),require("jquery")):n.MG=t(n.d3,n.jQuery)})(this,function(n,t){function a(n){var i=t(n.target).find("h2.mg-chart-title"),r,u;if(n.title&&n.title!==i.text())i.remove();else{if(n.title&&n.title!=="")return;i.remove()}n.target&&n.title&&(u=n.description?'<i class="fa fa-question-circle fa-inverse description"><\/i>':"",t(n.target).prepend('<h2 class="mg-chart-title">'+n.title+u+"<\/h2>"),n.description&&(r=t(n.target).find("h2.mg-chart-title"),r.popover({html:!0,animation:!1,content:n.description,trigger:"hover",placement:"top",container:r})));n.error&&ei(n)}function d(n){for(var u,t,e=i(n.target),o=n.chart_type==="point"?n.buffer/2:n.buffer*2/3,f=[],r=0;r<n.data.length;r++)for(u=0;u<n.data[r].length;u++)f.push(n.data[r][u]);t=e.selectAll("line.mg-y-rug").data(f);t.enter().append("svg:line").attr("class","mg-y-rug").attr("opacity",.3);t.exit().remove();t.exit().remove();t.attr("x1",n.left+1).attr("x2",n.left+o).attr("y1",n.scalefns.yf).attr("y2",n.scalefns.yf);n.color_accessor?(t.attr("stroke",n.scalefns.color),t.classed("mg-y-rug-mono",!1)):(t.attr("stroke",null),t.classed("mg-y-rug-mono",!0))}function e(r){function w(n){return n===1e3?3:n===1e6?7:Math.log(n)/Math.LN10}var v,y,o,u,f,c,s,h,l,e,b,a,k;r.processed||(r.processed={});v=i(r.target);y=t(t(r.target).find("svg").get(0));r.scalefns.yf=function(n){return r.scales.Y(n[r.y_accessor])};var p=!1,g=function(n){return n[r.y_accessor]>0},nt=function(n){return n[r.y_accessor]};for(c=0;c<r.data.length;c++)s=r.data[c],r.y_scale_type==="log"&&(s=s.filter(g)),s.length>0&&(h=n.extent(s,nt),p?(u=Math.min(h[0],u),f=Math.max(h[1],f)):(u=h[0],f=h[1],p=!0));return(u>=0&&!r.min_y&&!r.min_y_from_data&&(u=0),r.chart_type==="bar"&&(u=0,f=n.max(r.data[0],function(n){var t=[];return t.push(n[r.y_accessor]),r.baseline_accessor!==null&&t.push(n[r.baseline_accessor]),r.predictor_accessor!==null&&t.push(n[r.predictor_accessor]),Math.max.apply(null,t)})),u=r.min_y!==null?r.min_y:u,f=r.max_y!==null?r.max_y:f*r.inflator,r.y_scale_type!=="log"&&(u>=0?r.y_axis_negative=!1:(u=u-f*(r.inflator-1),r.y_axis_negative=!0)),!r.min_y&&r.min_y_from_data&&(u=u/r.inflator),r.y_scale_type==="log"?(r.chart_type==="histogram"?u=.2:u<=0&&(u=1),r.scales.Y=n.scale.log().domain([u,f]).range([r.height-r.bottom-r.buffer,r.top]).clamp(!0)):r.scales.Y=n.scale.linear().domain([u,f]).range([r.height-r.bottom-r.buffer,r.top]),r.processed.min_y=u,r.processed.max_y=f,r.scales.Y_axis=n.scale.linear().domain([r.processed.min_y,r.processed.max_y]).range([r.height-r.bottom-r.buffer,r.top]),l=r.yax_format,l||(l=r.format==="count"?function(t){if(t<1)return r.yax_units+n.round(t,r.decimals);var i=n.formatPrefix(t);return r.yax_units+i.scale(t)+i.symbol}:function(t){var i=n.format("%p");return i(t)}),y.find(".mg-y-axis").remove(),!r.y_axis)?this:(o=v.append("g").classed("mg-y-axis",!0).classed("mg-y-axis-small",r.use_small_class),r.y_label&&o.append("text").attr("class","label").attr("x",function(){return-1*(r.top+r.buffer+(r.height-r.bottom-r.buffer-(r.top+r.buffer))/2)}).attr("y",function(){return r.left/2}).attr("dy","0.4em").attr("text-anchor","middle").text(function(){return r.y_label}).attr("transform",function(){return"rotate(-90)"}),e=r.scales.Y.ticks(r.yax_count),r.y_scale_type==="log"&&(e=e.filter(function(n){return Math.abs(w(n))%1<1e-6||Math.abs(w(n))%1>1-1e-6})),b=r.scales.Y.ticks(r.yax_count).length,a=!0,t.each(r.data,function(n,i){t.each(i,function(n,t){if(t[r.y_accessor]%1!=0)return a=!1,!1})}),a&&b>f&&r.format==="count"&&(e=e.filter(function(n){return n%1==0})),k=e.length-1,r.x_extended_ticks||r.y_extended_ticks||o.append("line").attr("x1",r.left).attr("x2",r.left).attr("y1",r.scales.Y(e[0]).toFixed(2)).attr("y2",r.scales.Y(e[k]).toFixed(2)),o.selectAll(".mg-yax-ticks").data(e).enter().append("line").classed("mg-extended-y-ticks",r.y_extended_ticks).attr("x1",r.left).attr("x2",function(){return r.y_extended_ticks?r.width-r.right:r.left-r.yax_tick_length}).attr("y1",function(n){return r.scales.Y(n).toFixed(2)}).attr("y2",function(n){return r.scales.Y(n).toFixed(2)}),o.selectAll(".mg-yax-labels").data(e).enter().append("text").attr("x",r.left-r.yax_tick_length*3/2).attr("dx",-3).attr("y",function(n){return r.scales.Y(n).toFixed(2)}).attr("dy",".35em").attr("text-anchor","end").text(function(n){return l(n)}),r.y_rug&&d(r),this)}function g(r){var u,f,e;return(r.scales.Y=n.scale.ordinal().domain(r.categorical_variables).rangeRoundBands([r.height-r.bottom-r.buffer,r.top],r.padding_percentage,r.outer_padding_percentage),r.scalefns.yf=function(n){return r.scales.Y(n[r.y_accessor])},u=i(r.target),f=t(t(r.target).find("svg").get(0)),f.find(".mg-y-axis").remove(),e=u.append("g").classed("mg-y-axis",!0).classed("mg-y-axis-small",r.use_small_class),!r.y_axis)?this:(e.selectAll("text").data(r.categorical_variables).enter().append("svg:text").attr("x",r.left).attr("y",function(n){return r.scales.Y(n)+r.scales.Y.rangeBand()/2+r.buffer*r.outer_padding_percentage}).attr("dy",".35em").attr("text-anchor","end").text(String),this)}function nt(n){for(var u,t,e=n.chart_type==="point"?n.buffer/2:n.buffer,o=i(n.target),f=[],r=0;r<n.data.length;r++)for(u=0;u<n.data[r].length;u++)f.push(n.data[r][u]);t=o.selectAll("line.mg-x-rug").data(f);t.enter().append("svg:line").attr("class","mg-x-rug").attr("opacity",.3);t.exit().remove();t.exit().remove();t.attr("x1",n.scalefns.xf).attr("x2",n.scalefns.xf).attr("y1",n.height-n.top+e).attr("y2",n.height-n.top);n.color_accessor?(t.attr("stroke",n.scalefns.color),t.classed("mg-x-rug-mono",!1)):(t.attr("stroke",null),t.classed("mg-x-rug-mono",!0))}function o(r){var f=i(r.target),e=t(t(r.target).find("svg").get(0)),u,o;return(r.processed={},r.scalefns.xf=function(n){return r.scales.X(n[r.x_accessor])},r.chart_type==="point"&&(it(r),rt(r)),st(r),r.scales.X=r.time_series?n.time.scale():n.scale.linear(),r.scales.X.domain([r.processed.min_x,r.processed.max_x]).range([r.left+r.buffer,r.width-r.right-r.buffer-r.additional_buffer]),e.find(".mg-x-axis").remove(),!r.x_axis)?this:(u=f.append("g").classed("mg-x-axis",!0).classed("mg-x-axis-small",r.use_small_class),o=r.scales.X.ticks(r.xax_count).length-1,r.x_label&&ut(u,r),et(u,r),ot(u,r),r.x_rug&&nt(r),this)}function tt(r){var h=r.width,u=0,e,o,s,f;return(r.chart_type==="bar"&&(u=r.buffer+5),r.scales.X=n.scale.ordinal().domain(r.categorical_variables.reverse()).rangeRoundBands([r.left,r.width-r.right-r.buffer-u]),r.scalefns.xf=function(n){return r.scales.X(n[r.x_accessor])},e=i(r.target),o=t(t(r.target).find("svg").get(0)),o.find(".mg-x-axis").remove(),s=e.append("g").classed("mg-x-axis",!0).classed("mg-x-axis-small",r.use_small_class),!r.x_axis)?this:(f=s.selectAll("text").data(r.categorical_variables).enter().append("svg:text"),f.attr("x",function(n){return r.scales.X(n)+r.scales.X.rangeBand()/2+r.buffer*r.outer_padding_percentage+u/2}).attr("y",r.height-r.bottom+r.buffer).attr("dy",".35em").attr("text-anchor","middle").text(String),f.each(function(n){var t=this,i=r.scales.X.rangeBand();fi(t,n,i)}),this)}function it(t){var u,f,i,r;t.color_accessor!==null&&(t.color_domain===null?t.color_type==="number"?(u=n.min(t.data[0],function(n){return n[t.color_accessor]}),f=n.max(t.data[0],function(n){return n[t.color_accessor]}),i=[u,f]):t.color_type==="category"&&(i=n.set(t.data[0].map(function(n){return n[t.color_accessor]})).values(),i.sort()):i=t.color_domain,r=t.color_range===null?t.color_type==="number"?["blue","red"]:null:t.color_range,t.color_type==="number"?t.scales.color=n.scale.linear().domain(i).range(r).clamp(!0):(t.scales.color=t.color_range!==null?n.scale.ordinal().range(r):i.length>10?n.scale.category20():n.scale.category10(),t.scales.color.domain(i)),t.scalefns.color=function(n){return t.scales.color(n[t.color_accessor])})}function rt(t){var r,u,i,f;t.size_accessor!==null&&(t.size_domain===null?(r=n.min(t.data[0],function(n){return n[t.size_accessor]}),u=n.max(t.data[0],function(n){return n[t.size_accessor]}),i=[r,u]):i=t.size_domain,f=t.size_range===null?[1,5]:t.size_range,t.scales.size=n.scale.linear().domain(i).range(f).clamp(!0),t.scalefns.size=function(n){return t.scales.size(n[t.size_accessor])})}function ut(n,t){n.append("text").attr("class","label").attr("x",function(){return t.left+t.buffer+(t.width-t.right-t.buffer-(t.left+t.buffer))/2}).attr("y",(t.height-t.bottom/2).toFixed(2)).attr("dy",".50em").attr("text-anchor","middle").text(function(){return t.x_label})}function ft(t){return t.xax_format?t.xax_format:function(i){if(i<1)return t.yax_units+n.round(i,t.decimals);var r=n.formatPrefix(i);return t.xax_units+r.scale(i)+r.symbol}}function v(i){if(i.xax_format)return i.xax_format;var f,r,u;return i.time_series&&(f=(i.processed.max_x-i.processed.min_x)/1e3,f<60?(r=n.time.format("%M:%S"),u="seconds"):f/3600<=24?(r=n.time.format("%H:%M"),u="less-than-a-day"):f/3600<=96?(r=n.time.format("%H:%M"),u="four-days"):(r=n.time.format("%b %d"),u="default")),i.processed.main_x_time_format=r,i.processed.x_time_frame=u,function(r){var f=n.time.format("%b %d"),u=n.formatPrefix(r);return t.type(i.data[0][0][i.x_accessor])==="date"?i.processed.main_x_time_format(r):t.type(i.data[0][0][i.x_accessor])==="number"?r<1?i.yax_units+n.round(r,i.decimals):(u=n.formatPrefix(r),i.xax_units+u.scale(r)+u.symbol):r}}function et(n,t){var i=t.scales.X.ticks(t.xax_count).length-1;t.chart_type==="bar"||t.x_extended_ticks||t.y_extended_ticks||n.append("line").attr("x1",t.concise===!1||t.xax_count===0?t.left+t.buffer:t.scales.X(t.scales.X.ticks(t.xax_count)[0]).toFixed(2)).attr("x2",t.concise===!1||t.xax_count===0?t.width-t.right-t.buffer:t.scales.X(t.scales.X.ticks(t.xax_count)[i]).toFixed(2)).attr("y1",t.height-t.bottom).attr("y2",t.height-t.bottom);n.selectAll(".mg-xax-ticks").data(t.scales.X.ticks(t.xax_count)).enter().append("line").attr("x1",function(n){return t.scales.X(n).toFixed(2)}).attr("x2",function(n){return t.scales.X(n).toFixed(2)}).attr("y1",t.height-t.bottom).attr("y2",function(){return t.x_extended_ticks?t.top:t.height-t.bottom+t.xax_tick_length}).attr("class",function(){if(t.x_extended_ticks)return"mg-extended-x-ticks"})}function ot(t,i){var r,u,e,f,o;if(t.selectAll(".mg-xax-labels").data(i.scales.X.ticks(i.xax_count)).enter().append("text").attr("x",function(n){return i.scales.X(n).toFixed(2)}).attr("y",(i.height-i.bottom+i.xax_tick_length*7/3).toFixed(2)).attr("dy",".50em").attr("text-anchor","middle").text(function(n){return i.xax_units+i.xax_format(n)}),i.time_series&&(i.show_years||i.show_secondary_x_label)){e=i.processed.x_time_frame;switch(e){case"seconds":r=n.time.days;u=n.time.format("%I %p");break;case"less-than-a-day":r=n.time.days;u=n.time.format("%b %d");break;case"four-days":r=n.time.days;u=n.time.format("%b %d");break;default:r=n.time.years;u=n.time.format("%Y")}f=r(i.processed.min_x,i.processed.max_x);f.length===0&&(o=i.scales.X.ticks(i.xax_count)[0],f=[o]);t=t.append("g").classed("mg-year-marker",!0).classed("mg-year-marker-small",i.use_small_class);e==="default"&&t.selectAll(".mg-year-marker").data(f).enter().append("line").attr("x1",function(n){return i.scales.X(n).toFixed(2)}).attr("x2",function(n){return i.scales.X(n).toFixed(2)}).attr("y1",i.top).attr("y2",i.height-i.bottom);t.selectAll(".mg-year-marker").data(f).enter().append("text").attr("x",function(n){return i.scales.X(n).toFixed(2)}).attr("y",(i.height-i.bottom+i.xax_tick_length*7/1.3).toFixed(2)).attr("dy",i.use_small_class?-3:0).attr("text-anchor","middle").text(function(n){return u(n)})}}function st(t){var f,i,r,u,e,o;if(t.chart_type==="line")for(u=0;u<t.data.length;u++)f=t.data[u].length-1,(t.data[u][0][t.x_accessor]<i||!i)&&(i=t.data[u][0][t.x_accessor]),(t.data[u][f][t.x_accessor]>r||!r)&&(r=t.data[u][f][t.x_accessor]);else t.chart_type==="point"||t.chart_type==="histogram"?(r=n.max(t.data[0],function(n){return n[t.x_accessor]}),i=n.min(t.data[0],function(n){return n[t.x_accessor]})):t.chart_type==="bar"&&(i=0,r=n.max(t.data[0],function(n){var i=[];return i.push(n[t.x_accessor]),t.baseline_accessor!==null&&i.push(n[t.baseline_accessor]),t.predictor_accessor!==null&&i.push(n[t.predictor_accessor]),Math.max.apply(null,i)}));i===r&&(i instanceof Date?(e=MG.clone(i).setDate(i.getDate()-1),o=MG.clone(i).setDate(i.getDate()+1),i=e,r=o):typeof i=="number"?(i=i-1,r=r+1):typeof i=="string"&&(i=Number(i)-1,r=Number(r)+1),t.xax_count=2);i=t.min_x?t.min_x:i;r=t.max_x?t.max_x:r;t.x_axis_negative=!1;t.processed.min_x=i;t.processed.max_x=r;ht(t);t.time_series||t.processed.min_x<0&&(t.processed.min_x=t.processed.min_x-t.processed.max_x*(t.inflator-1),t.x_axis_negative=!0);t.additional_buffer=t.chart_type==="bar"?t.buffer*5:0}function ht(n){n.xax_format||n.chart_type!=="line"||(n.xax_format=v(n));n.xax_format||n.chart_type!=="point"||(n.xax_format=v(n));n.xax_format||n.chart_type!=="histogram"||(n.xax_format=v(n));n.xax_format||n.chart_type!=="bar"||(n.xax_format=ft(n))}function s(i){var s,o,r,e,c,h,l,v;if(i||(i={}),i=u(i,{target:null,title:null,description:null}),n.select(i.target).empty()){console.warn('The specified target element "'+i.target+'" could not be found in the page. The chart will not be rendered.');return}if(i.time_series=t.type(i.data[0][0][i.x_accessor])==="date"?!0:!1,s=i.width,o=i.height,i.full_width&&(s=b(i.target)),i.fill_height&&(o=ti(i.target)),i.chart_type==="bar"&&o===null&&(o=i.height=i.data[0].length*i.bar_height+i.top+i.bottom),r=t(i.target).find("svg"),(r.find(".mg-main-line").length>0&&i.chart_type!=="line"||r.find(".mg-points").length>0&&i.chart_type!=="point"||r.find(".mg-histogram").length>0&&i.chart_type!=="histogram"||r.find(".mg-barplot").length>0&&i.chart_type!=="bar")&&t(i.target).empty(),t.trim(t(i.target).html())===""&&n.select(i.target).append("svg").classed("linked",i.linked).attr("width",s).attr("height",o),i.width=s,i.height=o,r=n.select(i.target).selectAll("svg"),r.append("defs").append("clipPath").attr("id","mg-plot-window-"+f(i.target)).append("svg:rect").attr("x",i.left).attr("y",i.top).attr("width",i.width-i.left-i.right-i.buffer).attr("height",i.height-i.top-i.bottom-i.buffer+1),s!==Number(r.attr("width"))&&r.attr("width",s),o!==Number(r.attr("height"))&&r.attr("height",o),r.attr("viewBox","0 0 "+s+" "+o),(i.full_width||i.full_height)&&r.attr("preserveAspectRatio","xMinYMin meet"),r.classed("mg-missing",!1),r.selectAll(".mg-missing-text").remove(),r.selectAll(".mg-missing-pane").remove(),a(i),i.use_small_class=i.height-i.top-i.bottom-i.buffer<=i.small_height_threshold&&i.width-i.left-i.right-i.buffer*2<=i.small_width_threshold||i.small_text,i.data.length<t(i.target).find("svg .mg-main-line").length)if(i.custom_line_color_map.length>0)for(c=function(n){var t=new Array(n);for(e=0;e<t.length;e++)t[e]=e+1;return t},h=ri(c(i.max_data_size),i.custom_line_color_map),e=0;e<h.length;e++)t(i.target).find("svg .mg-main-line.mg-line"+h[e]+"-color").remove();else for(l=i.data.length,v=t(i.target).find("svg .mg-main-line").length,e=v;e>l;e--)t(i.target).find("svg .mg-main-line.mg-line"+e+"-color").remove();return this}function h(i){var f=n.select(t(i.target).find("svg").get(0)),r,u;return t(i.target).find("svg .mg-markers").remove(),t(i.target).find("svg .mg-baselines").remove(),i.markers&&(r=f.append("g").attr("class","mg-markers"),r.selectAll(".mg-markers").data(i.markers.filter(function(n){return i.scales.X(n[i.x_accessor])>i.buffer+i.left&&i.scales.X(n[i.x_accessor])<i.width-i.buffer-i.right})).enter().append("line").attr("x1",function(n){return i.scales.X(n[i.x_accessor]).toFixed(2)}).attr("x2",function(n){return i.scales.X(n[i.x_accessor]).toFixed(2)}).attr("y1",i.top).attr("y2",function(){return i.height-i.bottom-i.buffer}).attr("stroke-dasharray","3,1"),r.selectAll(".mg-markers").data(i.markers.filter(function(n){return i.scales.X(n[i.x_accessor])>i.buffer+i.left&&i.scales.X(n[i.x_accessor])<i.width-i.buffer-i.right})).enter().append("text").attr("x",function(n){return i.scales.X(n[i.x_accessor])}).attr("y",i.top-8).attr("text-anchor","middle").text(function(n){return n.label})),i.baselines&&(u=f.append("g").attr("class","mg-baselines"),u.selectAll(".mg-baselines").data(i.baselines).enter().append("line").attr("x1",i.left+i.buffer).attr("x2",i.width-i.right-i.buffer).attr("y1",function(n){return i.scales.Y(n.value).toFixed(2)}).attr("y2",function(n){return i.scales.Y(n.value).toFixed(2)}),u.selectAll(".mg-baselines").data(i.baselines).enter().append("text").attr("x",i.width-i.right-i.buffer).attr("y",function(n){return i.scales.Y(n.value).toFixed(2)}).attr("dy",-3).attr("text-anchor","end").text(function(n){return n.label})),this}function c(n){ct(n)}function ct(t){(t.full_width||t.full_height)&&window.addEventListener("resize",function(){n.select(t.target).select("svg").attr("width",b(t.target))},!0)}function l(n){var i,r,t;if(n.chart_type==="line"?(i=n.data[0]instanceof Object&&!(n.data[0]instanceof Array),r=n.data[0]instanceof Array&&!(n.data[0][0]instanceof Object&&!(n.data[0][0]instanceof Date)),(i||r)&&(n.data=[n.data])):n.data[0]instanceof Array||(n.data=[n.data]),n.y_accessor instanceof Array&&(n.data=n.data.map(function(t){return n.y_accessor.map(function(n){return t.map(function(t){return(t=MG.clone(t),t[n]===undefined)?undefined:(t.multiline_y_accessor=t[n],t)}).filter(function(n){return n!==undefined})})})[0],n.y_accessor="multiline_y_accessor"),n.chart_type==="line")for(t=0;t<n.data.length;t++)n.data[t].sort(function(t,i){return t[n.x_accessor]-i[n.x_accessor]});return this}function lt(n){var c=t.type(n.data[0][0][n.x_accessor])==="date"?!0:!1,i,r,f,e;if(n.missing_is_zero&&n.chart_type==="line"&&c)for(i=0;i<n.data.length;i++)if(n.data[i].length!=1){var s=n.data[i][0],o=n.data[i][n.data[i].length-1],u=[],h=MG.clone(s[n.x_accessor]).setDate(s[n.x_accessor].getDate()+1),l=n.min_x?n.min_x:h,a=n.max_x?n.max_x:o[n.x_accessor];for(r=new Date(l);r<=a;r.setDate(r.getDate()+1))f={},r.setHours(0,0,0,0),Date.parse(r)===Date.parse(new Date(h))&&u.push(MG.clone(n.data[i][0])),e=null,t.each(n.data[i],function(t,i){if(Date.parse(i[n.x_accessor])===Date.parse(new Date(r)))return e=i,!1}),e?u.push(e):(f[n.x_accessor]=new Date(r),f[n.y_accessor]=0,u.push(f)),Date.parse(r)===Date.parse(new Date(o[n.x_accessor]))&&u.push(o);n.data[i]=u}return this}function at(t){var r=t.data[0],e,u,f,o,i;if(t.binned===!1){if(typeof r[0]=="object")e=r.map(function(n){return n[t.x_accessor]});else if(typeof r[0]=="number")e=r;else{console.log("TypeError: expected an array of numbers, found "+typeof r[0]);return}u=n.layout.histogram();t.bins&&(u=u.bins(t.bins));t.processed_data=u(e).map(function(n){return{x:n.x,y:n.y,dx:n.dx}})}else for(t.processed_data=r.map(function(n){return{x:n[t.x_accessor],y:n[t.y_accessor]}}),i=0;i<t.processed_data.length;i++)f=t.processed_data[i],i===t.processed_data.length-1?f.dx=t.processed_data[i-1].dx:(o=t.processed_data[i+1],f.dx=o.x-f.x);return t.data=[t.processed_data],t.x_accessor=t.processed_x_accessor,t.y_accessor=t.processed_y_accessor,this}function vt(t){var e,i={},u=t.data[0],o=t.bar_orientation==="vertical"?t.x_accessor:t.y_accessor,s=t.bar_orientation==="vertical"?t.y_accessor:t.x_accessor,r,f;if(t.categorical_variables=[],t.binned===!1){for(e=typeof u[0]=="object"?u.map(function(n){return n[o]}):u,f=0;f<e.length;f++)r=e[f],t.categorical_variables.indexOf(r)===-1&&t.categorical_variables.push(r),i.hasOwnProperty(r)||(i[r]=0),i[r]+=1;i=Object.keys(i).map(function(n){var t={};return t[s]=i[n],t[o]=n,t})}else i=u,t.categorical_variables=n.set(i.map(function(n){return n[o]})).values(),t.categorical_variables.reverse();return t.data=[i],this}function yt(n){var t=n.data[0],i=t.map(function(t){return t[n.x_accessor]}),r=t.map(function(t){return t[n.y_accessor]});return n.least_squares&&(n.ls_line=wt(i,r)),this}function pt(i){var f=n.select(t(i.target).find("svg").get(0)),e=i.data[0],r=i.scales.X.ticks(i.xax_count)[0],u=i.scales.X.ticks(i.xax_count)[i.scales.X.ticks(i.xax_count).length-1];t(i.target).find(".mg-least-squares-line").remove();f.append("svg:line").attr("x1",i.scales.X(r)).attr("x2",i.scales.X(u)).attr("y1",i.scales.Y(i.ls_line.fit(r))).attr("y2",i.scales.Y(i.ls_line.fit(u))).attr("class","mg-least-squares-line")}function wt(t,i){var u,s,f,c,y=t.length,r,o,h;u=t[0]instanceof Date?t.map(function(n){return n.getTime()}):t;s=i[0]instanceof Date?i.map(function(n){return n.getTime()}):i;var e=n.mean(u),l=n.mean(s),a=0,v=0;for(r=0;r<u.length;r++)f=u[r],c=s[r],a+=(f-e)*(c-l),v+=(f-e)*(f-e);return o=a/v,h=l-o*e,{x0:h,beta:o,fit:function(n){return h+n*o}}}function p(n,t){return n>=0&&n<=1?Math.pow(1-Math.pow(n,t),t):0}function bt(n){return p(n,2)}function kt(n){return p(n,3)}function i(t){return n.select(t).select("svg")}function f(n){var t=n.replace(/[^a-zA-Z0-9 _]+/g,"");return t.replace(/ +?/g,"")}function w(t,i){return Number(n.select(t).style(i).replace(/px/g,""))}function b(n){return w(n,"width")}function ti(n){return w(n,"height")}function u(n){return k(Array.prototype.slice.call(arguments,1),function(t){if(t)for(var i in t)n[i]===void 0&&(n[i]=t[i])}),n}function ri(n,t){for(var r=[],u=[],i=0;i<t.length;i++)r[t[i]]=!0;for(i=0;i<n.length;i++)r[n[i]]||u.push(n[i]);return u}function ui(n,t){console.warn("Deprecation: "+n+(t?". This feature will be removed in "+t+".":" the near future."));console.trace()}function fi(n,t,i){var r,u=0;for(n.textContent=t,r=n.getBBox();r.width>i;)if(n.textContent=t.slice(0,--u)+"...",r=n.getBBox(),n.textContent==="...")break}function ei(n){console.log("ERROR : ",n.target," : ",n.error);t(n.target).find(".mg-chart-title").append('<i class="fa fa-x fa-exclamation-circle warning"><\/i>')}var r,k;window.MG={version:"2.1.0"};r={};MG.globals={};MG.deprecations={rollover_callback:{replacement:"mouseover",version:"2.0"},rollout_callback:{replacement:"mouseout",version:"2.0"},show_years:{replacement:"show_secondary_x_label",version:"2.1"}};MG.globals.link=!1;MG.globals.version="1.1";MG.data_graphic=function(){var i={},n,o,e;i.all={missing_is_zero:!1,legend:"",legend_target:"",error:"",animate_on_load:!1,top:40,bottom:30,right:10,left:50,buffer:8,width:350,height:220,full_width:!1,full_height:!1,small_height_threshold:120,small_width_threshold:160,small_text:!1,xax_count:6,xax_tick_length:5,yax_count:5,yax_tick_length:5,x_extended_ticks:!1,y_extended_ticks:!1,y_scale_type:"linear",max_x:null,max_y:null,min_x:null,min_y:null,min_y_from_data:!1,point_size:2.5,x_accessor:"date",xax_units:"",x_label:"",x_axis:!0,y_axis:!0,y_accessor:"value",y_label:"",yax_units:"",x_rug:!1,y_rug:!1,transition_on_update:!0,mouseover:null,show_rollover_text:!0,show_confidence_band:null,xax_format:null,area:!0,chart_type:"line",data:[],decimals:2,format:"count",inflator:10/9,linked:!1,linked_format:"%Y-%m-%d",list:!1,baselines:null,markers:null,scalefns:{},scales:{},show_secondary_x_label:!0,target:"#viz",interpolate:"cardinal",custom_line_color_map:[],max_data_size:null,aggregate_rollover:!1};i.point={buffer:16,ls:!1,lowess:!1,point_size:2.5,size_accessor:null,color_accessor:null,size_range:null,color_range:null,size_domain:null,color_domain:null,color_type:"number"};i.histogram={mouseover:function(n){t("#histogram svg .mg-active-datapoint").html("Frequency Count: "+n.y)},binned:!1,bins:null,processed_x_accessor:"x",processed_y_accessor:"y",processed_dx_accessor:"dx",bar_margin:1};i.bar={y_accessor:"factor",x_accessor:"value",baseline_accessor:null,predictor_accessor:null,predictor_proportion:5,dodge_accessor:null,binned:!0,padding_percentage:0,outer_padding_percentage:.1,height:500,top:20,bar_height:20,left:70};i.missing={top:40,bottom:30,right:10,left:10,buffer:8,legend_target:"",width:350,height:220,missing_text:"Data currently missing or unavailable",scalefns:{},scales:{},show_missing_background:!0,interpolate:"cardinal"};n=arguments[0];n||(n={});n.list&&(n.x_accessor=0,n.y_accessor=1);for(o in MG.deprecations)if(n.hasOwnProperty(o)){var s=MG.deprecations[o],h="Use of `args."+o+"` has been deprecated",f=s.replacement;if(f&&(n[f]?h+=". The replacement - `args."+f+"` - has already been defined. This definition will be discarded.":n[f]=n[o]),s.warned)continue;s.warned=!0;f&&(h+=" in favor of `args."+f+"`");ui(h,s.version)}return n.chart_type==="missing-data"?(n=u(n,i.missing),r.missing(n)):n.chart_type==="point"?(e=u(i.point,i.all),n=u(n,e),r.point(n).mainPlot().markers().rollover().windowListeners()):n.chart_type==="histogram"?(e=u(i.histogram,i.all),n=u(n,e),r.histogram(n).mainPlot().markers().rollover().windowListeners()):n.chart_type==="bar"?(e=u(i.bar,i.all),n=u(n,e),r.bar(n).mainPlot().markers().rollover().windowListeners()):(n=u(n,i.all),r.line(n).markers().mainPlot().rollover().windowListeners()),n.data};
/*!
     * Bootstrap v3.3.1 (http://getbootstrap.com)
     * Copyright 2011-2014 Twitter, Inc.
     * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
     */
/*!
     * Generated using the Bootstrap Customizer (http://getbootstrap.com/customize/?id=698666b23215c58f23d4)
     * Config saved to config.json and https://gist.github.com/698666b23215c58f23d4
     */
if(typeof jQuery=="undefined")throw new Error("Bootstrap's JavaScript requires jQuery");+function(n){var t=n.fn.jquery.split(" ")[0].split(".");if(t[0]<2&&t[1]<9||t[0]==1&&t[1]==9&&t[2]<1)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher");}(jQuery);+function(n){function r(i){return this.each(function(){var f=n(this),r=f.data("bs.tooltip"),u=typeof i=="object"&&i,e=u&&u.selector;(r||i!="destroy")&&(e?(r||f.data("bs.tooltip",r={}),r[e]||(r[e]=new t(this,u))):r||f.data("bs.tooltip",r=new t(this,u)),typeof i=="string"&&r[i]())})}var t,i;if(typeof n().tooltip=="function")return!0;t=function(n,t){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null;this.init("tooltip",n,t)};t.VERSION="3.3.1";t.TRANSITION_DURATION=150;t.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"><\/div><div class="tooltip-inner"><\/div><\/div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}};t.prototype.init=function(t,i,r){var f,e,u,o,s;for(this.enabled=!0,this.type=t,this.$element=n(i),this.options=this.getOptions(r),this.$viewport=this.options.viewport&&n(this.options.viewport.selector||this.options.viewport),f=this.options.trigger.split(" "),e=f.length;e--;)if(u=f[e],u=="click")this.$element.on("click."+this.type,this.options.selector,n.proxy(this.toggle,this));else if(u!="manual"){o=u=="hover"?"mouseenter":"focusin";s=u=="hover"?"mouseleave":"focusout";this.$element.on(o+"."+this.type,this.options.selector,n.proxy(this.enter,this));this.$element.on(s+"."+this.type,this.options.selector,n.proxy(this.leave,this))}this.options.selector?this._options=n.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()};t.prototype.getDefaults=function(){return t.DEFAULTS};t.prototype.getOptions=function(t){return t=n.extend({},this.getDefaults(),this.$element.data(),t),t.delay&&typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),t};t.prototype.getDelegateOptions=function(){var t={},i=this.getDefaults();return this._options&&n.each(this._options,function(n,r){i[n]!=r&&(t[n]=r)}),t};t.prototype.enter=function(t){var i=t instanceof this.constructor?t:n(t.currentTarget).data("bs."+this.type);if(i&&i.$tip&&i.$tip.is(":visible")){i.hoverState="in";return}if(i||(i=new this.constructor(t.currentTarget,this.getDelegateOptions()),n(t.currentTarget).data("bs."+this.type,i)),clearTimeout(i.timeout),i.hoverState="in",!i.options.delay||!i.options.delay.show)return i.show();i.timeout=setTimeout(function(){i.hoverState=="in"&&i.show()},i.options.delay.show)};t.prototype.leave=function(t){var i=t instanceof this.constructor?t:n(t.currentTarget).data("bs."+this.type);if(i||(i=new this.constructor(t.currentTarget,this.getDelegateOptions()),n(t.currentTarget).data("bs."+this.type,i)),clearTimeout(i.timeout),i.hoverState="out",!i.options.delay||!i.options.delay.hide)return i.hide();i.timeout=setTimeout(function(){i.hoverState=="out"&&i.hide()},i.options.delay.hide)};t.prototype.show=function(){var c=n.Event("show.bs."+this.type),l,p,h;if(this.hasContent()&&this.enabled){if(this.$element.trigger(c),l=n.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]),c.isDefaultPrevented()||!l)return;var u=this,r=this.tip(),a=this.getUID(this.type);this.setContent();r.attr("id",a);this.$element.attr("aria-describedby",a);this.options.animation&&r.addClass("fade");var i=typeof this.options.placement=="function"?this.options.placement.call(this,r[0],this.$element[0]):this.options.placement,v=/\s?auto?\s?/i,y=v.test(i);y&&(i=i.replace(v,"")||"top");r.detach().css({top:0,left:0,display:"block"}).addClass(i).data("bs."+this.type,this);this.options.container?r.appendTo(this.options.container):r.insertAfter(this.$element);var f=this.getPosition(),o=r[0].offsetWidth,s=r[0].offsetHeight;if(y){var w=i,b=this.options.container?n(this.options.container):this.$element.parent(),e=this.getPosition(b);i=i=="bottom"&&f.bottom+s>e.bottom?"top":i=="top"&&f.top-s<e.top?"bottom":i=="right"&&f.right+o>e.width?"left":i=="left"&&f.left-o<e.left?"right":i;r.removeClass(w).addClass(i)}p=this.getCalculatedOffset(i,f,o,s);this.applyPlacement(p,i);h=function(){var n=u.hoverState;u.$element.trigger("shown.bs."+u.type);u.hoverState=null;n=="out"&&u.leave(u)};n.support.transition&&this.$tip.hasClass("fade")?r.one("bsTransitionEnd",h).emulateTransitionEnd(t.TRANSITION_DURATION):h()}};t.prototype.applyPlacement=function(t,i){var r=this.tip(),l=r[0].offsetWidth,e=r[0].offsetHeight,o=parseInt(r.css("margin-top"),10),s=parseInt(r.css("margin-left"),10),h,f,u;isNaN(o)&&(o=0);isNaN(s)&&(s=0);t.top=t.top+o;t.left=t.left+s;n.offset.setOffset(r[0],n.extend({using:function(n){r.css({top:Math.round(n.top),left:Math.round(n.left)})}},t),0);r.addClass("in");h=r[0].offsetWidth;f=r[0].offsetHeight;i=="top"&&f!=e&&(t.top=t.top+e-f);u=this.getViewportAdjustedDelta(i,t,h,f);u.left?t.left+=u.left:t.top+=u.top;var c=/top|bottom/.test(i),a=c?u.left*2-l+h:u.top*2-e+f,v=c?"offsetWidth":"offsetHeight";r.offset(t);this.replaceArrow(a,r[0][v],c)};t.prototype.replaceArrow=function(n,t,i){this.arrow().css(i?"left":"top",50*(1-n/t)+"%").css(i?"top":"left","")};t.prototype.setContent=function(){var n=this.tip(),t=this.getTitle();n.find(".tooltip-inner")[this.options.html?"html":"text"](t);n.removeClass("fade in top bottom left right")};t.prototype.hide=function(i){function e(){r.hoverState!="in"&&u.detach();r.$element.removeAttr("aria-describedby").trigger("hidden.bs."+r.type);i&&i()}var r=this,u=this.tip(),f=n.Event("hide.bs."+this.type);if(this.$element.trigger(f),!f.isDefaultPrevented())return u.removeClass("in"),n.support.transition&&this.$tip.hasClass("fade")?u.one("bsTransitionEnd",e).emulateTransitionEnd(t.TRANSITION_DURATION):e(),this.hoverState=null,this};t.prototype.fixTitle=function(){var n=this.$element;(n.attr("title")||typeof n.attr("data-original-title")!="string")&&n.attr("data-original-title",n.attr("title")||"").attr("title","")};t.prototype.hasContent=function(){return this.getTitle()};t.prototype.getPosition=function(t){t=t||this.$element;var u=t[0],r=u.tagName=="BODY",i=u.getBoundingClientRect();i.width==null&&(i=n.extend({},i,{width:i.right-i.left,height:i.bottom-i.top}));var f=r?{top:0,left:0}:t.offset(),e={scroll:r?document.documentElement.scrollTop||document.body.scrollTop:t.scrollTop()},o=r?{width:n(window).width(),height:n(window).height()}:null;return n.extend({},i,e,o,f)};t.prototype.getCalculatedOffset=function(n,t,i,r){return n=="bottom"?{top:t.top+t.height,left:t.left+t.width/2-i/2}:n=="top"?{top:t.top-r,left:t.left+t.width/2-i/2}:n=="left"?{top:t.top+t.height/2-r/2,left:t.left-i}:{top:t.top+t.height/2-r/2,left:t.left+t.width}};t.prototype.getViewportAdjustedDelta=function(n,t,i,r){var f={top:0,left:0},e,u,o,s,h,c;return this.$viewport?(e=this.options.viewport&&this.options.viewport.padding||0,u=this.getPosition(this.$viewport),/right|left/.test(n)?(o=t.top-e-u.scroll,s=t.top+e-u.scroll+r,o<u.top?f.top=u.top-o:s>u.top+u.height&&(f.top=u.top+u.height-s)):(h=t.left-e,c=t.left+e+i,h<u.left?f.left=u.left-h:c>u.width&&(f.left=u.left+u.width-c)),f):f};t.prototype.getTitle=function(){var t=this.$element,n=this.options;return t.attr("data-original-title")||(typeof n.title=="function"?n.title.call(t[0]):n.title)};t.prototype.getUID=function(n){do n+=~~(Math.random()*1e6);while(document.getElementById(n));return n};t.prototype.tip=function(){return this.$tip=this.$tip||n(this.options.template)};t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")};t.prototype.enable=function(){this.enabled=!0};t.prototype.disable=function(){this.enabled=!1};t.prototype.toggleEnabled=function(){this.enabled=!this.enabled};t.prototype.toggle=function(t){var i=this;t&&(i=n(t.currentTarget).data("bs."+this.type),i||(i=new this.constructor(t.currentTarget,this.getDelegateOptions()),n(t.currentTarget).data("bs."+this.type,i)));i.tip().hasClass("in")?i.leave(i):i.enter(i)};t.prototype.destroy=function(){var n=this;clearTimeout(this.timeout);this.hide(function(){n.$element.off("."+n.type).removeData("bs."+n.type)})};i=n.fn.tooltip;n.fn.tooltip=r;n.fn.tooltip.Constructor=t;n.fn.tooltip.noConflict=function(){return n.fn.tooltip=i,this}}(jQuery);+function(n){function r(i){return this.each(function(){var f=n(this),r=f.data("bs.popover"),u=typeof i=="object"&&i,e=u&&u.selector;(r||i!="destroy")&&(e?(r||f.data("bs.popover",r={}),r[e]||(r[e]=new t(this,u))):r||f.data("bs.popover",r=new t(this,u)),typeof i=="string"&&r[i]())})}var t,i;if(typeof n().popover=="function")return!0;if(t=function(n,t){this.init("popover",n,t)},!n.fn.tooltip)throw new Error("Popover requires tooltip.js");t.VERSION="3.3.1";t.DEFAULTS=n.extend({},n.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"><\/div><h3 class="popover-title"><\/h3><div class="popover-content"><\/div><\/div>'});t.prototype=n.extend({},n.fn.tooltip.Constructor.prototype);t.prototype.constructor=t;t.prototype.getDefaults=function(){return t.DEFAULTS};t.prototype.setContent=function(){var n=this.tip(),i=this.getTitle(),t=this.getContent();n.find(".popover-title")[this.options.html?"html":"text"](i);n.find(".popover-content").children().detach().end()[this.options.html?typeof t=="string"?"html":"append":"text"](t);n.removeClass("fade top bottom left right in");n.find(".popover-title").html()||n.find(".popover-title").hide()};t.prototype.hasContent=function(){return this.getTitle()||this.getContent()};t.prototype.getContent=function(){var t=this.$element,n=this.options;return t.attr("data-content")||(typeof n.content=="function"?n.content.call(t[0]):n.content)};t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};t.prototype.tip=function(){return this.$tip||(this.$tip=n(this.options.template)),this.$tip};i=n.fn.popover;n.fn.popover=r;n.fn.popover.Constructor=t;n.fn.popover.noConflict=function(){return n.fn.popover=i,this}}(jQuery);
/*!
     * Bootstrap v3.3.1 (http://getbootstrap.com)
     * Copyright 2011-2014 Twitter, Inc.
     * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
     */
/*!
     * Generated using the Bootstrap Customizer (http://getbootstrap.com/customize/?id=c3834cc5b59ef727da53)
     * Config saved to config.json and https://gist.github.com/c3834cc5b59ef727da53
     */
if(typeof jQuery=="undefined")throw new Error("Bootstrap's JavaScript requires jQuery");return+function(n){var t=n.fn.jquery.split(" ")[0].split(".");if(t[0]<2&&t[1]<9||t[0]==1&&t[1]==9&&t[2]<1)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher");}(jQuery),+function(n){function r(t){t&&t.which===3||(n(e).remove(),n(i).each(function(){var r=n(this),i=u(r),f={relatedTarget:this};i.hasClass("open")&&((i.trigger(t=n.Event("hide.bs.dropdown",f)),t.isDefaultPrevented())||(r.attr("aria-expanded","false"),i.removeClass("open").trigger("hidden.bs.dropdown",f)))}))}function u(t){var i=t.attr("data-target"),r;return i||(i=t.attr("href"),i=i&&/#[A-Za-z]/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,"")),r=i&&n(i),r&&r.length?r:t.parent()}function o(i){return this.each(function(){var r=n(this),u=r.data("bs.dropdown");u||r.data("bs.dropdown",u=new t(this));typeof i=="string"&&u[i].call(r)})}var f;if(typeof n().dropdown=="function")return!0;var e=".dropdown-backdrop",i='[data-toggle="dropdown"]',t=function(t){n(t).on("click.bs.dropdown",this.toggle)};t.VERSION="3.3.1";t.prototype.toggle=function(t){var f=n(this),i,o,e;if(!f.is(".disabled, :disabled")){if(i=u(f),o=i.hasClass("open"),r(),!o){if("ontouchstart"in document.documentElement&&!i.closest(".navbar-nav").length)n('<div class="dropdown-backdrop"/>').insertAfter(n(this)).on("click",r);if(e={relatedTarget:this},i.trigger(t=n.Event("show.bs.dropdown",e)),t.isDefaultPrevented())return;f.trigger("focus").attr("aria-expanded","true");i.toggleClass("open").trigger("shown.bs.dropdown",e)}return!1}};t.prototype.keydown=function(t){var e,o,s,h,f,r;if(/(38|40|27|32)/.test(t.which)&&!/input|textarea/i.test(t.target.tagName)&&(e=n(this),t.preventDefault(),t.stopPropagation(),!e.is(".disabled, :disabled"))){if(o=u(e),s=o.hasClass("open"),!s&&t.which!=27||s&&t.which==27)return t.which==27&&o.find(i).trigger("focus"),e.trigger("click");(h=" li:not(.divider):visible a",f=o.find('[role="menu"]'+h+', [role="listbox"]'+h),f.length)&&(r=f.index(t.target),t.which==38&&r>0&&r--,t.which==40&&r<f.length-1&&r++,~r||(r=0),f.eq(r).trigger("focus"))}};f=n.fn.dropdown;n.fn.dropdown=o;n.fn.dropdown.Constructor=t;n.fn.dropdown.noConflict=function(){return n.fn.dropdown=f,this};n(document).on("click.bs.dropdown.data-api",r).on("click.bs.dropdown.data-api",".dropdown form",function(n){n.stopPropagation()}).on("click.bs.dropdown.data-api",i,t.prototype.toggle).on("keydown.bs.dropdown.data-api",i,t.prototype.keydown).on("keydown.bs.dropdown.data-api",'[role="menu"]',t.prototype.keydown).on("keydown.bs.dropdown.data-api",'[role="listbox"]',t.prototype.keydown)}(jQuery),MG.button_layout=function(n){return this.target=n,this.feature_set={},this.public_name={},this.sorters={},this.manual=[],this.manual_map={},this.manual_callback={},this._strip_punctuation=function(n){var t=n.replace(/[^a-zA-Z0-9 _]+/g,"");return t.replace(/ +?/g,"")},this.data=function(n){return this._data=n,this},this.manual_button=function(n,t,i){return this.feature_set[n]=t,this.manual_map[this._strip_punctuation(n)]=n,this.manual_callback[n]=i,this},this.button=function(n){return arguments.length>1&&(this.public_name[n]=arguments[1]),arguments.length>2&&(this.sorters[n]=arguments[2]),this.feature_set[n]=[],this},this.callback=function(n){return this._callback=n,this},this.display=function(){var l=this._callback,a=this.manual_callback,o=this.manual_map,s,e,r,u,h,i,f,c,n;for(r=Object.keys(this.feature_set),h=function(n){return s[n]},i=0;i<this._data.length;i++)for(s=this._data[i],e=r.map(h),f=0;f<r.length;f++)u=r[f],this.feature_set[u].indexOf(e[f])===-1&&this.feature_set[u].push(e[f]);for(u in this.feature_set)this.sorters.hasOwnProperty(u)&&this.feature_set[u].sort(this.sorters[u]);t(this.target).empty();t(this.target).append("<div class='col-lg-12 segments text-center'><\/div>");c=function(){var i=t(this).data("key"),n=t(this).data("feature"),r;return t("."+n+"-btns button.btn span.title").html(i),o.hasOwnProperty(n)?(r=o[n],a[r](i)):l(n,i),!1};for(n in this.feature_set){for(r=this.feature_set[n],t(this.target+" div.segments").append('<div class="btn-group '+this._strip_punctuation(n)+'-btns text-left"><button type="button" class="btn btn-default btn-lg dropdown-toggle" data-toggle="dropdown"><span class=\'which-button\'>'+(this.public_name.hasOwnProperty(n)?this.public_name[n]:n)+"<\/span><span class='title'>"+(this.manual_callback.hasOwnProperty(n)?this.feature_set[n][0]:"all")+'<\/span><span class="caret"><\/span><\/button><ul class="dropdown-menu" role="menu">'+(this.manual_callback.hasOwnProperty(n)?"":'<li><a href="#" data-feature="'+n+'" data-key="all">All<\/a><\/li>')+(this.manual_callback.hasOwnProperty(n)?"":'<li class="divider"><\/li>')+"<\/ul><\/div>"),i=0;i<r.length;i++)r[i]!=="all"&&r[i]!==undefined&&t(this.target+" div."+this._strip_punctuation(n)+"-btns ul.dropdown-menu").append('<li><a href="#" data-feature="'+this._strip_punctuation(n)+'" data-key="'+r[i]+'">'+r[i]+"<\/a><\/li>");t("."+this._strip_punctuation(n)+"-btns .dropdown-menu li a").on("click",c)}return this},this},r.line=function(r){return this.args=r,this.init=function(n){return l(n),lt(n),s(n),o(n),e(n),this},this.mainPlot=function(){var o=i(r.target),a=0,v=r.transition_on_update?1e3:0,b=function(n){return n[r.y_accessor]},y=n.svg.area().x(r.scalefns.xf).y0(r.scales.Y.range()[0]).y1(r.scalefns.yf).interpolate(r.interpolate),p,w=t(r.target).find(".mg-confidence-band"),u,e,s,h;w.length>0&&w.remove();r.show_confidence_band&&(p=n.svg.area().x(r.scalefns.xf).y0(function(n){var t=r.show_confidence_band[0];return r.scales.Y(n[t])}).y1(function(n){var t=r.show_confidence_band[1];return r.scales.Y(n[t])}).interpolate(r.interpolate));var c=n.svg.line().x(r.scalefns.xf).y(r.scalefns.yf).interpolate(r.interpolate),k=n.svg.line().x(r.scalefns.xf).y(function(){return r.scales.Y(a)}).interpolate(r.interpolate),l="",d;for(u=r.data.length-1;u>=0;u--)d=r.data[u],e=u+1,r.custom_line_color_map.length>0&&(e=r.custom_line_color_map[u]),r.data[u].line_id=e,r.show_confidence_band&&o.append("path").attr("class","mg-confidence-band").attr("d",p(r.data[u])).attr("clip-path","url(#mg-plot-window-"+f(r.target)+")"),s=t(r.target).find("svg path.mg-area"+e+"-color"),r.area&&!r.use_data_y_min&&!r.y_axis_negative&&r.data.length<=1?s.length>0?(t(o.node()).find(".mg-y-axis").after(s.detach()),n.select(s.get(0)).transition().duration(v).attr("d",y(r.data[u])).attr("clip-path","url(#mg-plot-window)")):o.append("path").attr("class","mg-main-area mg-area"+e+"-color").attr("d",y(r.data[u])).attr("clip-path","url(#mg-plot-window-"+f(r.target)+")"):s.length>0&&s.remove(),h=t(r.target).find("svg path.mg-main-line.mg-line"+e+"-color").first(),h.length>0?(t(o.node()).find(".mg-y-axis").after(h.detach()),n.select(h.get(0)).transition().duration(v).attr("d",c(r.data[u]))):r.animate_on_load?(a=n.median(r.data[u],b),o.append("path").attr("class","mg-main-line mg-line"+e+"-color").attr("d",k(r.data[u])).transition().duration(1e3).attr("d",c(r.data[u])).attr("clip-path","url(#mg-plot-window-"+f(r.target)+")")):o.append("path").attr("class","mg-main-line mg-line"+e+"-color").attr("d",c(r.data[u])).attr("clip-path","url(#mg-plot-window-"+f(r.target)+")"),r.legend&&(l="<span class='mg-line"+e+"-legend-color'>&mdash; "+r.legend[u]+"&nbsp; <\/span>"+l);return r.legend&&t(r.legend_target).html(l),this},this.markers=function(){return h(r),this},this.rollover=function(){var s=i(r.target),c=t(t(r.target).find("svg").get(0)),o,f,e,l,h,u,a;for(c.find(".mg-rollover-rect").remove(),c.find(".mg-voronoi").remove(),c.find(".mg-active-datapoint").remove(),c.find(".mg-line-rollover-circle").remove(),s.append("g").attr("class","mg-active-datapoint-container").attr("transform","translate("+(r.width-r.right)+","+r.top/2+")").append("text").attr("class","mg-active-datapoint").classed("mg-active-datapoint-small",r.use_small_class).attr("xml:space","preserve").attr("text-anchor","end"),s.selectAll(".mg-line-rollover-circle").data(r.data).enter().append("circle").attr({"class":function(n){return["mg-line-rollover-circle","mg-line"+n.line_id+"-color","mg-area"+n.line_id+"-color"].join(" ")},cx:0,cy:0,r:0}),f=1,e=0;e<r.data.length;e++){for(l=0;l<r.data[e].length;l++)r.data[e][l].line_id=r.custom_line_color_map.length>0?r.custom_line_color_map[e]:f;f++}if(r.data.length>1&&!r.aggregate_rollover){a=n.geom.voronoi().x(function(n){return r.scales.X(n[r.x_accessor]).toFixed(2)}).y(function(n){return r.scales.Y(n[r.y_accessor]).toFixed(2)}).clipExtent([[r.buffer,r.buffer],[r.width-r.buffer,r.height-r.buffer]]);o=s.append("g").attr("class","mg-voronoi");h=n.nest().key(function(n){return r.scales.X(n[r.x_accessor])+","+r.scales.Y(n[r.y_accessor])}).rollup(function(n){return n[0]}).entries(n.merge(r.data.map(function(n){return n}))).map(function(n){return n.values});o.selectAll("path").data(a(h)).enter().append("path").attr("d",function(n){return"M"+n.join("L")+"Z"}).datum(function(n){return n.point}).attr("class",function(t){if(r.linked){var i=t[r.x_accessor],u=n.time.format(r.linked_format),f=typeof i=="number"?e:u(i);return"mg-line"+t.line_id+"-color roll_"+f}return"mg-line"+t.line_id+"-color"}).on("mouseover",this.rolloverOn(r)).on("mouseout",this.rolloverOff(r)).on("mousemove",this.rolloverMove(r))}else if(r.data.length>1&&r.aggregate_rollover){h=n.nest().key(function(n){return n[r.x_accessor]}).entries(n.merge(r.data));u=h.map(function(n){return r.scales.X(new Date(n.key))});o=s.append("g").attr("class","mg-rollover-rect");o.selectAll(".mg-rollover-rects").data(h).enter().append("rect").attr("x",function(n,t){return u.length===1?r.left+r.buffer:t===0?u[t].toFixed(2):((u[t-1]+u[t])/2).toFixed(2)}).attr("y",r.top).attr("width",function(n,t){return u.length===1?r.width-r.right-r.buffer:t===0?((u[t+1]-u[t])/2).toFixed(2):t==u.length-1?((u[t]-u[t-1])/2).toFixed(2):((u[t+1]-u[t-1])/2).toFixed(2)}).attr("height",r.height-r.bottom-r.top-r.buffer).attr("opacity",0).on("mouseover",this.rolloverOn(r)).on("mouseout",this.rolloverOff(r)).on("mousemove",this.rolloverMove(r))}else{f=1;r.custom_line_color_map.length>0&&(f=r.custom_line_color_map[0]);o=s.append("g").attr("class","mg-rollover-rect");u=r.data[0].map(r.scalefns.xf);o.selectAll(".mg-rollover-rects").data(r.data[0]).enter().append("rect").attr("class",function(t,i){if(r.linked){var u=t[r.x_accessor],e=n.time.format(r.linked_format),o=typeof u=="number"?i:e(u);return"mg-line"+f+"-color roll_"+o}return"mg-line"+f+"-color"}).attr("x",function(n,t){return u.length===1?r.left+r.buffer:t===0?u[t].toFixed(2):((u[t-1]+u[t])/2).toFixed(2)}).attr("y",function(n){return r.data.length>1?r.scalefns.yf(n)-6:r.top}).attr("width",function(n,t){return u.length===1?r.width-r.right-r.buffer:t===0?((u[t+1]-u[t])/2).toFixed(2):t===u.length-1?((u[t]-u[t-1])/2).toFixed(2):((u[t+1]-u[t-1])/2).toFixed(2)}).attr("height",function(){return r.data.length>1?12:r.height-r.bottom-r.top-r.buffer}).attr("opacity",0).on("mouseover",this.rolloverOn(r)).on("mouseout",this.rolloverOff(r)).on("mousemove",this.rolloverMove(r))}return r.data.length==1&&r.data[0].length==1&&n.select(".mg-rollover-rect .mg-line1-color").on("mouseover")(r.data[0][0],0),this},this.rolloverOn=function(t){var u=i(t.target),r;switch(t.processed.x_time_frame){case"seconds":r=n.time.format("%b %e, %Y  %H:%M:%S");break;case"less-than-a-day":r=n.time.format("%b %e, %Y  %I:%M%p");break;case"four-days":r=n.time.format("%b %e, %Y  %I:%M%p");break;default:r=n.time.format("%b %e, %Y")}return function(i,f){var h,a,c;if(t.aggregate_rollover&&t.data.length>1)u.selectAll("circle.mg-line-rollover-circle").style("opacity",0),i.values.forEach(function(n){if(n[t.x_accessor]>=t.processed.min_x&&n[t.x_accessor]<=t.processed.max_x&&n[t.y_accessor]>=t.processed.min_y&&n[t.y_accessor]<=t.processed.max_y)var i=u.select("circle.mg-line"+n.line_id+"-color").attr({cx:function(){return t.scales.X(n[t.x_accessor]).toFixed(2)},cy:function(){return t.scales.Y(n[t.y_accessor]).toFixed(2)},r:t.point_size}).style("opacity",1)});else if(i[t.x_accessor]>=t.processed.min_x&&i[t.x_accessor]<=t.processed.max_x&&i[t.y_accessor]>=t.processed.min_y&&i[t.y_accessor]<=t.processed.max_y&&u.selectAll("circle.mg-line-rollover-circle").attr("class","").attr("class","mg-area"+i.line_id+"-color").classed("mg-line-rollover-circle",!0).attr("cx",function(){return t.scales.X(i[t.x_accessor]).toFixed(2)}).attr("cy",function(){return t.scales.Y(i[t.y_accessor]).toFixed(2)}).attr("r",t.point_size).style("opacity",1),t.linked&&!MG.globals.link){MG.globals.link=!0;var l=i[t.x_accessor],v=n.time.format(t.linked_format),y=typeof l=="number"?f:v(l);n.selectAll(".mg-line"+i.line_id+"-color.roll_"+y).each(function(t,i){n.select(this).on("mouseover")(t,i)})}if(u.selectAll("text").filter(function(n){return i===n}).attr("opacity",.3),h=t.format==="count"?function(i){var r=i%1!=0,u=n.format("0,000");return i=r?n.round(i,t.decimals):i,u(i)}:function(i){var r=(t.decimals?"."+t.decimals:"")+"%",u=n.format(r);return u(i)},t.show_rollover_text){var e=u.select(".mg-active-datapoint"),o=0,s=1.1;e.select("*").remove();t.aggregate_rollover&&t.data.length>1?(t.time_series?(a=new Date(i.key),e.append("tspan").text((r(a)+"  "+t.yax_units).trim()),o=1,i.values.forEach(function(n){var i=e.append("tspan").attr({x:0,y:o*s+"em"}).text(h(n[t.y_accessor]));e.append("tspan").attr({x:-i.node().getComputedTextLength(),y:o*s+"em"}).text("— ").classed("mg-hover-line"+n.line_id+"-color",!0).style("font-weight","bold");o++}),e.append("tspan").attr("x",0).attr("y",o*s+"em").text(" ")):i.values.forEach(function(n){var i=e.append("tspan").attr({x:0,y:o*s+"em"}).text(t.x_accessor+": "+n[t.x_accessor]+", "+t.y_accessor+": "+t.yax_units+h(n[t.y_accessor]));e.append("tspan").attr({x:-i.node().getComputedTextLength(),y:o*s+"em"}).text("— ").classed("mg-hover-line"+n.line_id+"-color",!0).style("font-weight","bold");o++}),e.append("tspan").attr("x",0).attr("y",o*s+"em").text(" ")):t.time_series?(c=new Date(+i[t.x_accessor]),c.setDate(c.getDate()),e.append("tspan").text(r(c)+"  "+t.yax_units+h(i[t.y_accessor]))):e.append("tspan").text(t.x_accessor+": "+i[t.x_accessor]+", "+t.y_accessor+": "+t.yax_units+h(i[t.y_accessor]))}t.mouseover&&t.mouseover(i,f)}},this.rolloverOff=function(t){var r=i(t.target);return function(i,u){if(t.linked&&MG.globals.link){MG.globals.link=!1;var f=i[t.x_accessor],e=n.time.format(t.linked_format),o=typeof f=="number"?u:e(f);n.selectAll(".roll_"+o).each(function(t){n.select(this).on("mouseout")(t)})}r.selectAll("circle.mg-line-rollover-circle").style("opacity",function(){return t.data.length==1&&t.data[0].length==1?1:0});r.select(".mg-active-datapoint").text("");t.mouseout&&t.mouseout(i,u)}},this.rolloverMove=function(n){return function(t,i){n.mousemove&&n.mousemove(t,i)}},this.windowListeners=function(){return c(this.args),this},this.init(r),this},r.histogram=function(r){return this.args=r,this.init=function(n){return l(n),at(n),s(n),o(n),e(n),this},this.mainPlot=function(){var f=i(r.target),e=t(t(r.target).find("svg").get(0)),n,u;return e.find(".mg-histogram").remove(),n=f.append("g").attr("class","mg-histogram"),u=n.selectAll(".mg-bar").data(r.data[0]).enter().append("g").attr("class","mg-bar").attr("transform",function(n){return"translate("+r.scales.X(n[r.x_accessor]).toFixed(2)+","+r.scales.Y(n[r.y_accessor]).toFixed(2)+")"}),u.append("rect").attr("x",1).attr("width",function(){return r.data[0].length===1?(r.scalefns.xf(r.data[0][0])-r.bar_margin).toFixed(2):(r.scalefns.xf(r.data[0][1])-r.scalefns.xf(r.data[0][0])-r.bar_margin).toFixed(2)}).attr("height",function(n){return n[r.y_accessor]===0?0:(r.height-r.bottom-r.buffer-r.scales.Y(n[r.y_accessor])).toFixed(2)}),this},this.markers=function(){return h(r),this},this.rollover=function(){var n=i(r.target),u=t(t(r.target).find("svg").get(0)),f,e;u.find(".mg-rollover-rect").remove();u.find(".mg-active-datapoint").remove();n.append("text").attr("class","mg-active-datapoint").attr("xml:space","preserve").attr("x",r.width-r.right).attr("y",r.top/2).attr("text-anchor","end");f=n.append("g").attr("class","mg-rollover-rect");e=f.selectAll(".mg-bar").data(r.data[0]).enter().append("g").attr("class",function(n,t){return r.linked?"mg-rollover-rects roll_"+t:"mg-rollover-rects"}).attr("transform",function(n){return"translate("+r.scales.X(n[r.x_accessor])+",0)"});e.append("rect").attr("x",1).attr("y",0).attr("width",function(n,t){return r.data[0].length===1?(r.scalefns.xf(r.data[0][0])-r.bar_margin).toFixed(2):t!==r.data[0].length-1?(r.scalefns.xf(r.data[0][t+1])-r.scalefns.xf(n)).toFixed(2):(r.scalefns.xf(r.data[0][1])-r.scalefns.xf(r.data[0][0])).toFixed(2)}).attr("height",function(){return r.height}).attr("opacity",0).on("mouseover",this.rolloverOn(r)).on("mouseout",this.rolloverOff(r)).on("mousemove",this.rolloverMove(r));return this},this.rolloverOn=function(r){var u=i(r.target),f=n.time.format("%Y-%m-%d");return function(i,f){u.selectAll("text").filter(function(n){return i===n}).attr("opacity",.3);var o=n.time.format("%b %e, %Y"),e;e=r.format==="count"?function(t){var i=t%1!=0,u=n.format("0,000");return t=i?n.round(t,r.decimals):t,u(t)}:function(t){var i=(r.decimals?"."+r.decimals:"")+"%",u=n.format(i);return u(t)};n.selectAll(t(r.target).find(" svg .mg-bar :eq("+f+")")).classed("active",!0);r.linked&&!MG.globals.link&&(MG.globals.link=!0,n.selectAll(".mg-rollover-rects.roll_"+f+" rect").each(function(t){n.select(this).on("mouseover")(t,f)}));r.show_rollover_text&&u.select(".mg-active-datapoint").text(function(){if(r.time_series){var n=new Date(+i[r.x_accessor]);return n.setDate(n.getDate()),o(n)+"  "+r.yax_units+e(i[r.y_accessor])}return r.x_accessor+": "+e(i[r.x_accessor])+", "+r.y_accessor+": "+r.yax_units+e(i[r.y_accessor])});r.mouseover&&r.mouseover(i,f)}},this.rolloverOff=function(r){var u=i(r.target);return function(i,f){r.linked&&MG.globals.link&&(MG.globals.link=!1,n.selectAll(".mg-rollover-rects.roll_"+f+" rect").each(function(t){n.select(this).on("mouseout")(t,f)}));n.selectAll(t(r.target).find("svg .mg-bar :eq("+f+")")).classed("active",!1);u.select(".mg-active-datapoint").text("");r.mouseout&&r.mouseout(i,f)}},this.rolloverMove=function(n){return function(t,i){n.mousemove&&n.mousemove(t,i)}},this.windowListeners=function(){return c(this.args),this},this.init(r),this},r.point=function(r){return this.args=r,this.init=function(n){return l(n),yt(n),s(n),o(n),e(n),this},this.markers=function(){return h(r),r.least_squares&&pt(r),this},this.mainPlot=function(){var f=i(r.target),e=t(t(r.target).find("svg").get(0)),u,n;return e.find(".mg-points").remove(),u=f.append("g").classed("mg-points",!0),n=u.selectAll("circle").data(r.data[0]).enter().append("svg:circle").attr("class",function(n,t){return"path-"+t}).attr("cx",r.scalefns.xf).attr("cy",r.scalefns.yf),r.color_accessor!==null?(n.attr("fill",r.scalefns.color),n.attr("stroke",r.scalefns.color)):n.classed("mg-points-mono",!0),r.size_accessor!==null?n.attr("r",r.scalefns.size):n.attr("r",r.point_size),this},this.rollover=function(){var u=i(r.target),f=t(t(r.target).find("svg").get(0)),e,o;f.find(".mg-voronoi").remove();f.find(".mg-active-datapoint").remove();u.append("text").attr("class","mg-active-datapoint").attr("xml:space","preserve").attr("x",r.width-r.right).attr("y",r.top/2).attr("text-anchor","end");e=n.geom.voronoi().x(r.scalefns.xf).y(r.scalefns.yf).clipExtent([[r.buffer,r.buffer],[r.width-r.buffer,r.height-r.buffer]]);o=u.append("g").attr("class","mg-voronoi");o.selectAll("path").data(e(r.data[0])).enter().append("path").attr("d",function(n){if(n!==undefined)return"M"+n.join(",")+"Z"}).attr("class",function(n,t){return"path-"+t}).style("fill-opacity",0).on("mouseover",this.rolloverOn(r)).on("mouseout",this.rolloverOff(r)).on("mousemove",this.rolloverMove(r));return this},this.rolloverOn=function(t){var r=i(t.target);return function(i,u){var e,o,f;r.selectAll(".mg-points circle").classed("selected",!1);e=r.selectAll(".mg-points circle.path-"+u).classed("selected",!0);t.size_accessor?e.attr("r",function(n){return t.scalefns.size(n)+1}):e.attr("r",t.point_size);t.linked&&!globals.link&&(globals.link=!0,n.selectAll(".mg-voronoi .path-"+u).each(function(){n.select(this).on("mouseover")(i,u)}));o=n.time.format("%b %e, %Y");f=t.format==="count"?function(i){var r=i%1!=0,u=n.format("0,000");return i=r?n.round(i,t.decimals):i,u(i)}:function(i){var r=(t.decimals?"."+t.decimals:"")+"%",u=n.format(r);return u(i)};t.show_rollover_text&&r.select(".mg-active-datapoint").text(function(){if(t.time_series){var n=new Date(+i.point[t.x_accessor]);return n.setDate(n.getDate()),o(n)+"  "+t.yax_units+f(i.point[t.y_accessor])}return t.x_accessor+": "+f(i.point[t.x_accessor])+", "+t.y_accessor+": "+t.yax_units+f(i.point[t.y_accessor])});t.mouseover&&t.mouseover(i,u)}},this.rolloverOff=function(t){var r=i(t.target);return function(i,u){t.linked&&globals.link&&(globals.link=!1,n.selectAll(".mg-voronoi .path-"+u).each(function(){n.select(this).on("mouseout")(i,u)}));var f=r.selectAll(".mg-points circle").classed("unselected",!1).classed("selected",!1);t.size_accessor?f.attr("r",t.scalefns.size):f.attr("r",t.point_size);r.select(".mg-active-datapoint").text("");t.mouseout&&t.mouseout(i,u)}},this.rolloverMove=function(n){return function(t,i){n.mousemove&&n.mousemove(t,i)}},this.update=function(){return this},this.windowListeners=function(){return c(this.args),this},this.init(r),this},r.bar=function(r){return this.args=r,this.is_vertical=!0,this.init=function(n){return l(n),vt(n),s(n),this.is_vertical=n.bar_orientation==="vertical",this.is_vertical?(tt(n),e(n)):(o(n),g(n)),this},this.mainPlot=function(){var a=i(r.target),y=r.data[0],f=a.select(".mg-barplot"),p=f.empty(),e,o,u,v,s,h=p&&r.animate_on_load,c=h||r.transition_on_update,l=r.transition_duration||1e3,n;return p?(f=a.append("g").classed("mg-barplot",!0),e=f.selectAll(".mg-bar").data(y).enter().append("rect").classed("mg-bar",!0),r.predictor_accessor&&(o=f.selectAll(".mg-bar-prediction").data(y).enter().append("rect").classed("mg-bar-prediction",!0)),r.baseline_accessor&&(s=f.selectAll(".mg-bar-baseline").data(y).enter().append("line").classed("mg-bar-baseline",!0))):(f=a.select("g.mg-barplot"),t(a.node()).find(".mg-y-axis").after(t(f.node()).detach()),e=f.selectAll("rect.mg-bar"),r.predictor_accessor&&(o=f.selectAll(".mg-bar-prediction")),r.baseline_accessor&&(s=f.selectAll(".mg-bar-baseline"))),this.is_vertical?(n=r.scales.X.rangeBand()/1.5,h&&e.attr("height",0).attr("y",r.scales.Y(0)),c&&(e=e.transition().duration(l)),e.attr("y",function(n){return r.scales.Y(0)-(r.scales.Y(0)-r.scalefns.yf(n))}).attr("x",function(t){return r.scalefns.xf(t)+n/2}).attr("width",n).attr("height",function(n){return 0-(r.scalefns.yf(n)-r.scales.Y(0))}),r.predictor_accessor&&(u=r.predictor_proportion,v=u-1,h&&o.attr("height",0).attr("y",r.scales.Y(0)),c&&(o=o.transition().duration(l)),o.attr("y",function(n){return r.scales.Y(0)-(r.scales.Y(0)-r.scales.Y(n[r.predictor_accessor]))}).attr("x",function(t){return r.scalefns.xf(t)+v*n/(u*2)+n/2}).attr("width",n/u).attr("height",function(n){return 0-(r.scales.Y(n[r.predictor_accessor])-r.scales.Y(0))})),r.baseline_accessor&&(u=r.predictor_proportion,h&&s.attr({y1:r.scales.Y(0),y2:r.scales.Y(0)}),c&&(s=s.transition().duration(l)),s.attr("x1",function(t){return r.scalefns.xf(t)+n/2-n/u+n/2}).attr("x2",function(t){return r.scalefns.xf(t)+n/2+n/u+n/2}).attr("y1",function(n){return r.scales.Y(n[r.baseline_accessor])}).attr("y2",function(n){return r.scales.Y(n[r.baseline_accessor])}))):(n=r.scales.Y.rangeBand()/1.5,h&&e.attr("width",0),c&&(e=e.transition().duration(l)),e.attr("x",r.scales.X(0)).attr("y",function(t){return r.scalefns.yf(t)+n/2}).attr("height",n).attr("width",function(n){return r.scalefns.xf(n)-r.scales.X(0)}),r.predictor_accessor&&(u=r.predictor_proportion,v=u-1,h&&o.attr("width",0),c&&(o=o.transition().duration(l)),o.attr("x",r.scales.X(0)).attr("y",function(t){return r.scalefns.yf(t)+v*n/(u*2)+n/2}).attr("height",n/u).attr("width",function(n){return r.scales.X(n[r.predictor_accessor])-r.scales.X(0)})),r.baseline_accessor&&(u=r.predictor_proportion,h&&s.attr({x1:r.scales.X(0),x2:r.scales.X(0)}),c&&(s=s.transition().duration(l)),s.attr("x1",function(n){return r.scales.X(n[r.baseline_accessor])}).attr("x2",function(n){return r.scales.X(n[r.baseline_accessor])}).attr("y1",function(t){return r.scalefns.yf(t)+n/2-n/u+n/2}).attr("y2",function(t){return r.scalefns.yf(t)+n/2+n/u+n/2}))),this},this.markers=function(){return h(r),this},this.rollover=function(){var u=i(r.target),f=t(t(r.target).find("svg").get(0)),e,n;if(f.find(".mg-rollover-rect").remove(),f.find(".mg-active-datapoint").remove(),u.append("text").attr("class","mg-active-datapoint").attr("xml:space","preserve").attr("x",r.width-r.right).attr("y",r.top/2).attr("dy",".35em").attr("text-anchor","end"),e=u.append("g").attr("class","mg-rollover-rect"),n=e.selectAll(".mg-bar-rollover").data(r.data[0]).enter().append("rect").attr("class","mg-bar-rollover"),this.is_vertical)n.attr("x",r.scalefns.xf).attr("y",function(){return r.scales.Y(0)-r.height}).attr("width",r.scales.X.rangeBand()).attr("height",r.height).attr("opacity",0).on("mouseover",this.rolloverOn(r)).on("mouseout",this.rolloverOff(r)).on("mousemove",this.rolloverMove(r));else n.attr("x",r.scales.X(0)).attr("y",r.scalefns.yf).attr("width",r.width).attr("height",r.scales.Y.rangeBand()+2).attr("opacity",0).on("mouseover",this.rolloverOn(r)).on("mouseout",this.rolloverOff(r)).on("mousemove",this.rolloverMove(r));return this},this.rolloverOn=function(r){var u=i(r.target),f=this.is_vertical?r.x_accessor:r.y_accessor,e=this.is_vertical?r.y_accessor:r.x_accessor,o=this.is_vertical?r.yax_units:r.xax_units;return function(i,s){u.selectAll("text").filter(function(n){return i===n}).attr("opacity",.3);var c=n.time.format("%b %e, %Y"),h;h=r.format==="count"?function(t){var i=t%1!=0,u=n.format("0,000");return t=i?n.round(t,r.decimals):t,u(t)}:function(t){var i=(r.decimals?"."+r.decimals:"")+"%",u=n.format(i);return u(t)};n.selectAll(t(r.target+" svg g.mg-barplot .mg-bar:eq("+s+")")).classed("active",!0);r.show_rollover_text&&u.select(".mg-active-datapoint").text(function(){if(r.time_series){var n=new Date(+i[e]);return n.setDate(n.getDate()),c(n)+"  "+o+h(i[f])}return i[f]+": "+h(i[e])});r.mouseover&&r.mouseover(i,s)}},this.rolloverOff=function(r){var u=i(r.target);return function(i,f){n.selectAll(t(r.target).find("svg g.mg-barplot .mg-bar:eq("+f+")")).classed("active",!1);u.select(".mg-active-datapoint").text("");r.mouseout&&r.mouseout(i,f)}},this.rolloverMove=function(n){return function(t,i){n.mousemove&&n.mousemove(t,i)}},this.windowListeners=function(){return c(this.args),this},this.init(r),this},MG.data_table=function(i){return this.args=i,this.args.standard_col={width:150,font_size:12,font_weight:"normal"},this.args.columns=[],this.formatting_options=[["color","color"],["font-weight","font_weight"],["font-style","font_style"],["font-size","font_size"]],this._strip_punctuation=function(n){var t=n.replace(/[^a-zA-Z0-9 _]+/g,"");return t.replace(/ +?/g,"")},this._format_element=function(n,t,i){this.formatting_options.forEach(function(r){var f=r[0],u=r[1];i[u]&&n.style(f,typeof i[u]=="string"||typeof i[u]=="number"?i[u]:i[u](t))})},this._add_column=function(n,t){var r=this.args.standard_col,i=u(MG.clone(n),MG.clone(r));i.type=t;this.args.columns.push(i)},this.target=function(){var n=arguments[0];return this.args.target=n,this},this.title=function(){return this._add_column(arguments[0],"title"),this},this.text=function(){return this._add_column(arguments[0],"text"),this},this.bullet=function(){return this},this.sparkline=function(){return this},this.number=function(){return this._add_column(arguments[0],"number"),this},this.display=function(){var u=this.args,o,l,s,p,w;a(u);for(var tt=u.target,b=n.select(tt).append("table").classed("mg-data-table",!0),it=b.append("colgroup"),rt=b.append("thead"),ut=b.append("tbody"),i,g,y,k,f,d,h,r,c,nt,v=rt.append("tr"),e=0;e<u.columns.length;e++)o=u.columns[e],f=o.type,h=o.label,h=h===undefined?"":h,y=v.append("th").style("width",o.width).style("text-align",f==="title"?"left":"right").text(h),o.description&&(y.append("i").classed("fa",!0).classed("fa-question-circle",!0).classed("fa-inverse",!0),t(y[0]).popover({html:!0,animation:!1,content:o.description,trigger:"hover",placement:"top",container:t(y[0])}));for(e=0;e<u.columns.length;e++)nt=it.append("col"),u.columns[e].type==="number"&&nt.attr("align","char").attr("char",".");for(l=0;l<u.data.length;l++)for(v=ut.append("tr"),s=0;s<u.columns.length;s++)i=u.columns[s],k=i.accessor,d=r=u.data[l][k],f=i.type,f==="number"&&(i.hasOwnProperty("round")&&!i.hasOwnProperty("format")&&(r=n.format("0,."+i.round+"f")(r)),i.hasOwnProperty("value_formatter")&&(r=i.value_formatter(r)),i.hasOwnProperty("format")&&(i.round&&(r=n.round(r,i.round)),p=i.format,p==="percentage"&&(w=n.format("%p")),p==="count"&&(w=n.format("0,000")),p==="temperature"&&(w=function(n){return n+"º"}),r=w(r)),i.hasOwnProperty("currency")&&(r=i.currency+r)),c=v.append("td").classed("table-"+f,!0).classed("table-"+f+"-"+this._strip_punctuation(k),!0).attr("data-value",d).style("width",i.width).style("text-align",f==="title"||f==="text"?"left":"right"),this._format_element(c,d,i),f==="title"?(g=c.append("div").text(r),this._format_element(g,r,i),u.columns[s].hasOwnProperty("secondary_accessor")&&c.append("div").text(u.data[l][u.columns[s].secondary_accessor]).classed("secondary-title",!0)):c.text(r);return this},this},r.missing=function(r){return this.args=r,this.init=function(r){var u,f,e;if(a(r),n.select(r.target).selectAll("svg").data([r]).enter().append("svg").attr("width",r.width).attr("height",r.height),u=i(r.target),r.width!==Number(u.attr("width"))&&u.attr("width",r.width),r.height!==Number(u.attr("height"))&&u.attr("height",r.height),n.select(r.target).selectAll("svg *").remove(),u.classed("mg-missing",!0),r.legend_target&&t(r.legend_target).html(""),r.show_missing_background){for(f=[],e=1;e<=50;e++)f.push({x:e,y:Math.random()-e*.03});r.scales.X=n.scale.linear().domain([0,f.length]).range([r.left+r.buffer,r.width-r.right-r.buffer]);r.scales.Y=n.scale.linear().domain([-2,2]).range([r.height-r.bottom-r.buffer*2,r.top]);r.scalefns.xf=function(n){return r.scales.X(n.x)};r.scalefns.yf=function(n){return r.scales.Y(n.y)};var s=n.svg.line().x(r.scalefns.xf).y(r.scalefns.yf).interpolate(r.interpolate),h=n.svg.area().x(r.scalefns.xf).y0(r.scales.Y.range()[0]).y1(r.scalefns.yf).interpolate(r.interpolate),o=u.append("g").attr("class","mg-missing-pane");o.append("svg:rect").classed("mg-missing-background",!0).attr("x",r.buffer).attr("y",r.buffer).attr("width",r.width-r.buffer*2).attr("height",r.height-r.buffer*2).attr("rx",15).attr("ry",15);o.append("path").attr("class","mg-main-line mg-line1-color").attr("d",s(f));o.append("path").attr("class","mg-main-area mg-area1-color").attr("d",h(f))}return u.selectAll(".mg-missing-text").data([r.missing_text]).enter().append("text").attr("class","mg-missing-text").attr("x",r.width/2).attr("y",r.height/2).attr("dy",".50em").attr("text-anchor","middle").text(r.missing_text),this},this.init(r),this},MG.convert={},MG.convert.date=function(t,i,r){return r=typeof r=="undefined"?"%Y-%m-%d":r,t.map(function(t){var u=n.time.format(r);return t[i]=u.parse(t[i]),t})},MG.convert.number=function(n,t){return n.map(function(n){return n[t]=Number(n[t]),n})},k=function(n,t,i){var r,f,u;if(n===null)return n;if(Array.prototype.forEach&&n.forEach===Array.prototype.forEach)n.forEach(t,i);else if(n.length===+n.length){for(r=0,f=n.length;r<f;r++)if(t.call(i,n[r],r,n)===breaker)return}else for(u in n)if(t.call(i,n[u],u,n)===breaker)return;return n},MG.clone=function(n){var t,i,u,r;if(null===n||"object"!=typeof n)return n;if(n instanceof Date)return t=new Date,t.setTime(n.getTime()),t;if(n instanceof Array){for(t=[],i=0,u=n.length;i<u;i++)t[i]=MG.clone(n[i]);return t}if(n instanceof Object){t={};for(r in n)n.hasOwnProperty(r)&&(t[r]=MG.clone(n[r]));return t}throw new Error("Unable to copy obj! Its type isn't supported.");},MG})}).call(this);