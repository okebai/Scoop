var Scoop;(function(n){var t=function(){function n(){this.hubName="performanceHub";this.charts={};this.performanceData={}}return n.prototype.init=function(n,t){var i=this;if(n!=null){n.on("updatePerformance",function(n,r,u){i.updatePerformanceData(t,n,r,u);i.updatePerformanceChart(t)});n.on("updatePerformanceHistory",function(n){var r,u;for(i.clearPerformanceData(t),r=0;r<n.length;r++)u=n[r],i.updatePerformanceData(t,u.Name,u.Values,u.Timestamp);i.updatePerformanceChart(t)})}},n.prototype.onConnect=function(n){n!=null&&n.invoke("GetPerformanceHistory")},n.prototype.onDisconnect=function(n){this.removePerformanceChart(n)},n.prototype.clearPerformanceData=function(n){delete this.performanceData[n.guid()]},n.prototype.updatePerformanceData=function(n,t,i,r){var u=n.guid(),e,f;for(this.performanceData[u]||(this.performanceData[u]=[[],[],[]]),e=moment().add(-3,"minutes"),f=0;f<this.performanceData[u].length;f++)this.performanceData[u][f]=$.grep(this.performanceData[u][f],function(n){return moment(n.x).isAfter(e)});this.performanceData[u][0].push({x:moment(r).toDate(),y:i["0"]/100});this.performanceData[u][1].push({x:moment(r).toDate(),y:i["1"]});this.performanceData[u][2].push({x:moment(r).toDate(),y:i["2"]/.1})},n.prototype.removePerformanceChart=function(n){var t=n.guid(),i="chart-target-"+t;this.charts[i]&&(this.charts[i].detach(),delete this.charts[i]);$("#chart-container-"+t).remove();delete this.performanceData[t]},n.prototype.updatePerformanceChart=function(n){var u,t,i,r,f;for(console.log("updatePerformanceChart",n.guid()),u=[],t=n.guid(),i=0;i<this.performanceData[t].length;i++)this.performanceData[t][i]!=null&&u.push({name:"series"+i,data:this.performanceData[t][i]});r="chart-target-"+t;f=$("#"+r);f.length?(this.charts[r].data={series:u},this.charts[r].update()):this.charts[r]=this.createChart(t,r,{series:u})},n.prototype.createChart=function(n,t,i){var r=$(".chart-container",".performance-task-template").clone(),u;return r.attr("id","chart-container-"+n),u=$(".chart-target",r),u.attr("id",t),$(".dashboard-container").append(r),new Chartist.Line("#"+t,i,{showArea:!0,showPoint:!1,axisX:{type:Chartist.FixedScaleAxis,divisor:6,labelInterpolationFnc:function(n){return moment(n).format("HH:mm:ss")}},axisY:{type:Chartist.FixedScaleAxis,high:1,low:0,ticks:[0,.1,.25,.5,.75,.9,1],labelInterpolationFnc:function(n){return Math.round(n*100)+" %"}}})},n}();n.PerformanceTask=t})(Scoop||(Scoop={}));